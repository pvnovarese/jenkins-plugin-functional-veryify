# This workflow just verifies that the given anchore endpoint is reachable and responsive
#
name: Anchore Enterprise Test

on: 
  #push:
  #  branches:
  #    - main
  schedule:
    - cron: '15 21 */14 * *'
  workflow_dispatch
  
jobs:
  Check-Endpoint:
    runs-on: ubuntu-latest
    env:
      ANCHORE_CLI_USER: ${{ secrets.ANCHORE_CLI_USER }}
      ANCHORE_CLI_PASS: ${{ secrets.ANCHORE_CLI_PASS }}
      ANCHORE_CLI_URL: ${{ secrets.ANCHORE_CLI_URL }}
      IMAGE: 'docker.io/busybox:latest'
    steps:
    - name: Checkout the code
      uses: actions/checkout@v2
    - name: Ping Endpoint
      run: | 
        curl -u ${ANCHORE_CLI_USER}:${ANCHORE_CLI_PASS} -X 'GET' -H 'accept: application/json' ${ANCHORE_CLI_URL}/status
    - name: Get System Status
      run: | 
        curl -u ${ANCHORE_CLI_USER}:${ANCHORE_CLI_PASS} -X 'GET' -H 'accept: application/json' ${ANCHORE_CLI_URL}/system
